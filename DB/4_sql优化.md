# SQL优化

关系代数为数据库提供数学基础，而不在依赖于纯经验

关系代数，关系是表，关系操作符，形成的代数，代数表达式能够转换为等价的关系表达式

数据库会对关系表达式进行等价变换，数据库通过关系代数变换，找到最优路径执行

SQL只提供要求，由数据库查询优化器提供具体的操作，是科学不是艺术。

数据库冗余最小：一二三范式。

层次型不集于科学。关系代数和查询优化器解决操作，范式解决冗余最小

Not Only SQL

排序、统计在SQL中，和关系理论无关

优化：在数据实际要发生执行是才发生；效率不同；权衡优劣：基于规则（为每种操作赋予权重）、基于成本（现在，更多的考虑，内存、数据状况等，综合所有状况）

SQL是优化起点，对优化的影响巨大

查询优化器对中间结果不同；SQL本身有太多查询

#### 只能对关系领域进行优化

比如，排序、限制是非关系代数领域

#### 优化器的有效范围

* 借助数据库中找到的信息
* 能够进行数学意义上的等价变换
* 优化器考虑整体时间
* 改善的是独立的查询

### SQL需要考虑的因素

#### 数据总量

最重要的因素

没有确定目标容量之前，能难判断

#### 结果集的大小

返回的数据量

取决于表的大小和过滤的细节

对结果集大小进行预测，最终的结果集

#### 表的数量

数量对性能有影响

表的join操作代价很高

* 太多的连接应该被质疑设计

* 对优化器，随着表的数量增加，复杂度呈指数增长。没法在有限时间得到所有的选择
* 编写太多表查询时，多种方式连接的选择失误可能性更高
* 复杂查询和复杂视图。对查询造成影响

#### 并发用户数

### 查询的过滤条件

如何限定结果集是最关键的因素

